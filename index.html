<!DOCTYPE html>
<!-- Deployment timestamp: 2025-08-05 11:35:00 -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Court Assistant Bot - Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e5e9;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .message-input:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: scale(1.05);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            margin-bottom: 15px;
            max-width: 70%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .welcome-message {
            text-align: center;
            color: #666;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e1e5e9;
        }

        .welcome-message h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .example-queries {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .example-query {
            background: #f0f2f5;
            border: 1px solid #e1e5e9;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-query:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 10px 20px;
            border-top: 1px solid #e1e5e9;
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-dot.offline {
            background: #dc3545;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
                                <h1>üèõÔ∏è Court Assistant Bot</h1>
                    <p>Test Interface for Court Case Management</p>
        </div>
        
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting to Bot API...</span>
            </div>
            <span id="messageCount">Messages: 0</span>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                <h3>üëã Welcome to the Court Assistant Bot!</h3>
                <p>This is a test interface for the WhatsApp Court Assistant Bot. You can ask questions about:</p>
                <div class="example-queries">
                    <div class="example-query" onclick="sendMessage('What is the status of case 1001/2015?')">Case Status</div>
                    <div class="example-query" onclick="sendMessage('Check defect status for CNR ODHC0010012015')">Defect Status</div>
                    <div class="example-query" onclick="sendMessage('Show cause list for today')">Cause List</div>
                    <div class="example-query" onclick="sendMessage('Hello, how can you help me?')">General Inquiry</div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
            <button class="send-button" id="sendButton" onclick="sendMessage()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const messageCount = document.getElementById('messageCount');

        let messageCountNum = 0;
        let apiStatus = 'checking';
        
        // Try multiple API endpoints
        const API_ENDPOINTS = [
            'https://wa-bot-suklm2nhva-el.a.run.app',
            'http://localhost:3000'
        ];
        
        let currentApiUrl = null;

        // Check API status on load
        checkApiStatus();

        async function checkApiStatus() {
            statusText.textContent = 'Checking API endpoints...';
            
            for (const endpoint of API_ENDPOINTS) {
                try {
                    const response = await fetch(`${endpoint}/health`, {
                        method: 'GET',
                        timeout: 5000
                    });
                    
                    if (response.ok) {
                        currentApiUrl = endpoint;
                        statusDot.classList.remove('offline');
                        statusText.textContent = `Connected to Bot API (${endpoint.includes('localhost') ? 'Local' : 'Cloud'})`;
                        apiStatus = 'connected';
                        return;
                    }
                } catch (error) {
                    console.log(`API endpoint ${endpoint} not available:`, error.message);
                }
            }
            
            // If no API is available, show offline status
            statusDot.classList.add('offline');
            statusText.textContent = 'Bot API Offline - Using Demo Mode';
            apiStatus = 'offline';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function addMessage(content, isUser = false, timestamp = new Date()) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const timeString = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    ${content}
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            if (isUser) {
                messageCountNum++;
                messageCount.textContent = `Messages: ${messageCountNum}`;
            }
        }

        function showTyping() {
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            chatContainer.appendChild(errorDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        async function sendMessage(customMessage = null) {
            const message = customMessage || messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            
            // Clear input
            if (!customMessage) {
                messageInput.value = '';
            }

            // Show typing indicator
            showTyping();
            
            // Disable send button
            sendButton.disabled = true;

            try {
                let response;
                
                if (apiStatus === 'connected' && currentApiUrl) {
                    // Try to send to actual API
                    response = await fetch(`${currentApiUrl}/api/test-message`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            userPhone: 'test_user_' + Date.now()
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        hideTyping();
                        
                        // Add bot response
                        addMessage(data.response || 'Thank you for your message. I\'m processing your request.');
                        return;
                    } else {
                        throw new Error('API request failed');
                    }
                } else {
                    throw new Error('No API available');
                }
            } catch (error) {
                hideTyping();
                
                // Fallback response for demo purposes
                const fallbackResponses = [
                    "I understand you're asking about court information. Let me help you with that.",
                    "Thank you for your inquiry. I'm here to assist you with court-related questions.",
                    "I can help you with case status, defect status, cause lists, and general court information.",
                    "Please provide more specific details about what you need help with.",
                    "For case status inquiries, please provide the case number or CNR.",
                    "For defect status, I'll need the case number or CNR to check for you.",
                    "I can help you find cause lists for different benches. Which bench are you interested in?"
                ];
                
                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                addMessage(randomResponse);
                
                if (apiStatus === 'checking') {
                    showError('API connection is being established. Using demo responses for now.');
                } else if (apiStatus === 'offline') {
                    showError('Bot API is currently offline. Using demo responses.');
                }
            } finally {
                sendButton.disabled = false;
                messageInput.focus();
            }
        }

        // Auto-focus input on load
        messageInput.focus();
    </script>
</body>
</html> 